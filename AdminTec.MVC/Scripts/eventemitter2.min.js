/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */
!function(n){function r(){this._events={};this._conf&&e.call(this,this._conf)}function e(t){t?(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),this._events.maxListeners=t.maxListeners!==n?t.maxListeners:f,t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),t.verboseMemoryLeak&&(this.verboseMemoryLeak=t.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._events.maxListeners=f}function o(n,t){var i="(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.";this.verboseMemoryLeak?(i+=" Event name: %s.",console.error(i,n,t)):console.error(i,n);console.trace&&console.trace()}function t(n){this._events={};this.newListener=!1;this.verboseMemoryLeak=!1;e.call(this,n)}function i(n,t,r,u){if(!r)return[];var e=[],c,p,f,l,o,a,v,s=t.length,h=t[u],y=t[u+1];if(u===s&&r._listeners){if(typeof r._listeners=="function")return n&&n.push(r._listeners),[r];for(c=0,p=r._listeners.length;c<p;c++)n&&n.push(r._listeners[c]);return[r]}if(h==="*"||h==="**"||r[h]){if(h==="*"){for(f in r)f!=="_listeners"&&r.hasOwnProperty(f)&&(e=e.concat(i(n,t,r[f],u+1)));return e}if(h==="**"){v=u+1===s||u+2===s&&y==="*";v&&r._listeners&&(e=e.concat(i(n,t,r,s)));for(f in r)f!=="_listeners"&&r.hasOwnProperty(f)&&(f==="*"||f==="**"?(r[f]._listeners&&!v&&(e=e.concat(i(n,t,r[f],s))),e=e.concat(i(n,t,r[f],u))):e=f===y?e.concat(i(n,t,r[f],u+2)):e.concat(i(n,t,r[f],u)));return e}e=e.concat(i(n,t,r[h],u+1))}if(l=r["*"],l&&i(n,t,l,u+1),o=r["**"],o)if(u<s){o._listeners&&i(n,t,o,s);for(f in o)f!=="_listeners"&&o.hasOwnProperty(f)&&(f===y?i(n,t,o[f],u+2):f===h?i(n,t,o[f],u+1):(a={},a[f]=o[f],i(n,t,{"**":a},u+1)))}else o._listeners?i(n,t,o,s):o["*"]&&o["*"]._listeners&&i(n,t,o["*"],s);return e}function s(t,i){var f,e,r,u;for(t=typeof t=="string"?t.split(this.delimiter):t.slice(),f=0,e=t.length;f+1<e;f++)if(t[f]==="**"&&t[f+1]==="**")return;for(r=this.listenerTree,u=t.shift();u!==n;){if(r[u]||(r[u]={}),r=r[u],t.length===0)return r._listeners?(typeof r._listeners=="function"&&(r._listeners=[r._listeners]),r._listeners.push(i),!r._listeners.warned&&this._events.maxListeners>0&&r._listeners.length>this._events.maxListeners&&(r._listeners.warned=!0,o.call(this,r._listeners.length,u))):r._listeners=i,!0;u=t.shift()}return!0}var u=Array.isArray?Array.isArray:function(n){return Object.prototype.toString.call(n)==="[object Array]"},f=10;t.EventEmitter2=t;t.prototype.delimiter=".";t.prototype.setMaxListeners=function(t){t!==n&&(this._events||r.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t)};t.prototype.event="";t.prototype.once=function(n,t){return this.many(n,1,t),this};t.prototype.many=function(n,t,i){function r(){--t==0&&u.off(n,r);i.apply(this,arguments)}var u=this;if(typeof i!="function")throw new Error("many only accepts instances of Function");r._origin=i;this.on(n,r);return u};t.prototype.emit=function(){var f,e,o,s,u,t,n,h;if(this._events||r.call(this),f=arguments[0],f==="newListener"&&!this.newListener&&!this._events.newListener)return!1;if(e=arguments.length,this._all&&this._all.length){if(n=this._all.slice(),e>3)for(o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];for(u=0,s=n.length;u<s;u++){this.event=f;switch(e){case 1:n[u].call(this,f);break;case 2:n[u].call(this,f,arguments[1]);break;case 3:n[u].call(this,f,arguments[1],arguments[2]);break;default:n[u].apply(this,o)}}}if(this.wildcard)n=[],h=typeof f=="string"?f.split(this.delimiter):f.slice(),i.call(this,n,h,this.listenerTree,0);else{if(n=this._events[f],typeof n=="function"){this.event=f;switch(e){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(o=new Array(e-1),t=1;t<e;t++)o[t-1]=arguments[t];n.apply(this,o)}return!0}n&&(n=n.slice())}if(n&&n.length){if(e>3)for(o=new Array(e-1),t=1;t<e;t++)o[t-1]=arguments[t];for(u=0,s=n.length;u<s;u++){this.event=f;switch(e){case 1:n[u].call(this);break;case 2:n[u].call(this,arguments[1]);break;case 3:n[u].call(this,arguments[1],arguments[2]);break;default:n[u].apply(this,o)}}return!0}if(!this._all&&f==="error"){if(arguments[1]instanceof Error)throw arguments[1];else throw new Error("Uncaught, unspecified 'error' event.");return!1}return!!this._all};t.prototype.emitAsync=function(){var e,u,o,s,h,f,n,t,c;if(this._events||r.call(this),e=arguments[0],e==="newListener"&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);if(u=[],o=arguments.length,this._all){if(o>3)for(s=new Array(o),n=1;n<o;n++)s[n]=arguments[n];for(f=0,h=this._all.length;f<h;f++){this.event=e;switch(o){case 1:u.push(this._all[f].call(this,e));break;case 2:u.push(this._all[f].call(this,e,arguments[1]));break;case 3:u.push(this._all[f].call(this,e,arguments[1],arguments[2]));break;default:u.push(this._all[f].apply(this,s))}}}if(this.wildcard?(t=[],c=typeof e=="string"?e.split(this.delimiter):e.slice(),i.call(this,t,c,this.listenerTree,0)):t=this._events[e],typeof t=="function"){this.event=e;switch(o){case 1:u.push(t.call(this));break;case 2:u.push(t.call(this,arguments[1]));break;case 3:u.push(t.call(this,arguments[1],arguments[2]));break;default:for(s=new Array(o-1),n=1;n<o;n++)s[n-1]=arguments[n];u.push(t.apply(this,s))}}else if(t&&t.length){if(o>3)for(s=new Array(o-1),n=1;n<o;n++)s[n-1]=arguments[n];for(f=0,h=t.length;f<h;f++){this.event=e;switch(o){case 1:u.push(t[f].call(this));break;case 2:u.push(t[f].call(this,arguments[1]));break;case 3:u.push(t[f].call(this,arguments[1],arguments[2]));break;default:u.push(t[f].apply(this,s))}}}else if(!this._all&&e==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(u)};t.prototype.on=function(n,t){if(typeof n=="function"){this.onAny(n);return this}if(typeof t!="function")throw new Error("on only accepts instances of Function");return(this._events||r.call(this),this.emit("newListener",n,t),this.wildcard)?(s.call(this,n,t),this):(this._events[n]?(typeof this._events[n]=="function"&&(this._events[n]=[this._events[n]]),this._events[n].push(t),!this._events[n].warned&&this._events.maxListeners>0&&this._events[n].length>this._events.maxListeners&&(this._events[n].warned=!0,o.call(this,this._events[n].length,n))):this._events[n]=t,this)};t.prototype.onAny=function(n){if(typeof n!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(n),this};t.prototype.addListener=t.prototype.on;t.prototype.off=function(t,r){function v(t){var u,f,r,i;if(t!==n){u=Object.keys(t);for(f in u)(r=u[f],i=t[r],i instanceof Function||typeof i!="object"||i===null)||(Object.keys(i).length>0&&v(t[r]),Object.keys(i).length===0&&delete t[r])}}var f,o,l,c,s,h,e,a;if(typeof r!="function")throw new Error("removeListener only takes instances of Function");if(o=[],this.wildcard)l=typeof t=="string"?t.split(this.delimiter):t.slice(),o=i.call(this,null,l,this.listenerTree,0);else{if(!this._events[t])return this;f=this._events[t];o.push({_listeners:f})}for(c=0;c<o.length;c++){if(s=o[c],f=s._listeners,u(f)){for(h=-1,e=0,a=f.length;e<a;e++)if(f[e]===r||f[e].listener&&f[e].listener===r||f[e]._origin&&f[e]._origin===r){h=e;break}if(h<0)continue;return this.wildcard?s._listeners.splice(h,1):this._events[t].splice(h,1),f.length===0&&(this.wildcard?delete s._listeners:delete this._events[t]),this.emit("removeListener",t,r),this}(f===r||f.listener&&f.listener===r||f._origin&&f._origin===r)&&(this.wildcard?delete s._listeners:delete this._events[t],this.emit("removeListener",t,r))}return v(this.listenerTree),this};t.prototype.offAny=function(n){var t=0,r=0,i;if(n&&this._all&&this._all.length>0){for(i=this._all,t=0,r=i.length;t<r;t++)if(n===i[t])return i.splice(t,1),this.emit("removeListenerAny",n),this}else{for(i=this._all,t=0,r=i.length;t<r;t++)this.emit("removeListenerAny",i[t]);this._all=[]}return this};t.prototype.removeListener=t.prototype.off;t.prototype.removeAllListeners=function(n){var f,u,t,e;if(arguments.length===0)return this._events&&r.call(this),this;if(this.wildcard)for(f=typeof n=="string"?n.split(this.delimiter):n.slice(),u=i.call(this,null,f,this.listenerTree,0),t=0;t<u.length;t++)e=u[t],e._listeners=null;else this._events&&(this._events[n]=null);return this};t.prototype.listeners=function(n){if(this.wildcard){var t=[],f=typeof n=="string"?n.split(this.delimiter):n.slice();return i.call(this,t,f,this.listenerTree,0),t}return this._events||r.call(this),this._events[n]||(this._events[n]=[]),u(this._events[n])||(this._events[n]=[this._events[n]]),this._events[n]};t.prototype.listenerCount=function(n){return this.listeners(n).length};t.prototype.listenersAny=function(){return this._all?this._all:[]};typeof define=="function"&&define.amd?define(function(){return t}):typeof exports=="object"?module.exports=t:window.EventEmitter2=t}();